<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JsSIP Web Client</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º JsSIP —á–µ—Ä–µ–∑ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/jssip@3.10.0/dist/jssip.min.js"></script>
</head>
<body>
    <h2>JsSIP Web Client</h2>
    <button onclick="startCall()">Call</button>

    <script>
        let ua = null; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è SIP-–∫–ª–∏–µ–Ω—Ç–∞

        function initializeJsSIP() {
            console.log("Initializing JsSIP...");
            
            const socket = new JsSIP.WebSocketInterface('wss://147.45.157.8:7443');
            const configuration = {
                sockets: [socket],
                uri: 'sip:205@147.45.157.8',
                password: '205',
                display_name: "Web Client",
                register: true
            };

            ua = new JsSIP.UA(configuration);

            ua.on('connected', () => console.log('‚úÖ JsSIP connected'));
            ua.on('disconnected', () => console.log('‚ùå JsSIP disconnected'));
            ua.on('registered', () => console.log('‚úÖ Registered'));
            ua.on('unregistered', () => console.log('üö´ Unregistered'));
            ua.on('registrationFailed', (e) => console.error('‚ùå Registration failed:', e));

            ua.start();
        }

        function startCall() {
            if (!ua) {
                console.error("‚ùå JsSIP is not initialized. Call `initializeJsSIP()` first!");
                return;
            }

            const eventHandlers = {
                progress: () => console.log('üîÑ Call is in progress'),
                failed: (e) => console.log('‚ùå Call failed', e),
                confirmed: () => console.log('‚úÖ Call confirmed'),
                ended: () => console.log('üî¥ Call ended'),
            };

            const options = {
                eventHandlers,
                mediaConstraints: { audio: true, video: false }
            };

            ua.call('sip:206@147.45.157.8', options);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º JsSIP —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        initializeJsSIP();
    </script>
</body>
</html>
