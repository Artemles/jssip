<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SIP</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º JsSIP –∏–∑ GitHub -->
    <script src="https://raw.githubusercontent.com/Artemles/jssip/main/jssip.min.js"></script>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 50px; }
        #log { white-space: pre-wrap; text-align: left; margin: 20px auto; width: 80%; max-width: 600px; border: 1px solid #ccc; padding: 10px; background: #f9f9f9; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px; }
    </style>
</head>
<body>

    <h1>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SIP</h1>
    <button onclick="connectSIP()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
    <button onclick="makeCall()">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
    <button onclick="hangupCall()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫</button>
    <div id="log"></div>

    <script>
        let ua;  // –û–±—ä–µ–∫—Ç SIP User Agent
        let session;  // –ê–∫—Ç–∏–≤–Ω—ã–π SIP-–∑–≤–æ–Ω–æ–∫

        function logMessage(message) {
            document.getElementById("log").innerText += message + "\n";
        }

        function connectSIP() {
            const socket = new JsSIP.WebSocketInterface("wss://147.45.157.8:8443");
            const configuration = {
                sockets: [socket],
                uri: "sip:202@147.45.157.8",
                password: "202",  // –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–æ–ª—å –æ—Ç SIP-–∞–∫–∫–∞—É–Ω—Ç–∞
                registrar_server: "sip:147.45.157.8",
                display_name: "SIP User 202",
                session_timers: false,
            };

            ua = new JsSIP.UA(configuration);

            ua.on("registered", () => logMessage("‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ SIP"));
            ua.on("registrationFailed", (event) => logMessage(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${event.cause}`));
            ua.on("newRTCSession", (data) => {
                session = data.session;
                logMessage("üìû –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫...");

                session.on("accepted", () => logMessage("‚úÖ –ó–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç"));
                session.on("ended", () => logMessage("‚ùå –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω"));
                session.on("failed", (e) => logMessage(`‚ùå –û—à–∏–±–∫–∞ –∑–≤–æ–Ω–∫–∞: ${e.cause}`));
            });

            ua.start();
        }

        function makeCall() {
            if (!ua) {
                logMessage("‚ùå SIP-–∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω!");
                return;
            }

            const target = "sip:201@147.45.157.8"; // –ö–æ–º—É –∑–≤–æ–Ω–∏–º
            const options = {
                mediaConstraints: { audio: true, video: false }
            };

            session = ua.call(target, options);
            session.on("progress", () => logMessage("‚è≥ –ó–≤–æ–Ω–æ–∫ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ..."));
            session.on("confirmed", () => logMessage("‚úÖ –ó–≤–æ–Ω–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"));
            session.on("ended", () => logMessage("‚ùå –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω"));
            session.on("failed", (e) => logMessage(`‚ùå –û—à–∏–±–∫–∞ –∑–≤–æ–Ω–∫–∞: ${e.cause}`));
        }

        function hangupCall() {
            if (session) {
                session.terminate();
                logMessage("üì¥ –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω –≤—Ä—É—á–Ω—É—é.");
            } else {
                logMessage("‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞.");
            }
        }
    </script>

</body>
</html>
